<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual da Bestie - Secando sem Neura</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        bestie: {
                            light: '#ffe4e6', // rose-100
                            DEFAULT: '#fb7185', // rose-400
                            dark: '#be123c', // rose-700
                            bg: '#fff1f2', // rose-50
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #fff1f2;
            -webkit-tap-highlight-color: transparent;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Loading Animation Styles */
        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #fb7185;
            border-radius: 50%;
            animation: typing 1s infinite;
            margin: 0 2px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
    </style>
</head>
<body class="text-gray-700 pb-20">

    <!-- Header -->
    <header class="fixed top-0 w-full z-40 bg-white/90 backdrop-blur-md shadow-sm border-b border-pink-100">
        <div class="max-w-md mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-bestie text-white flex items-center justify-center">
                    <i class="fa-solid fa-heart text-sm"></i>
                </div>
                <h1 class="font-bold text-lg text-bestie-dark tracking-wide">Manual da Bestie</h1>
            </div>
            <button class="w-8 h-8 rounded-full bg-pink-50 text-bestie flex items-center justify-center hover:bg-pink-100 transition">
                <i class="fa-regular fa-bell"></i>
            </button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-md mx-auto pt-20 px-4 min-h-screen" id="app-content">
        <!-- Content inject via JS -->
    </main>

    <!-- Recipe Details Modal (Hidden by default) -->
    <div id="recipe-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="closeRecipeModal()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl h-[80vh] overflow-y-auto transform transition-transform duration-300 translate-y-full md:max-w-md md:mx-auto md:inset-x-0" id="modal-panel">
            <!-- Modal Content -->
            <div class="relative p-6">
                <!-- Close Button -->
                <button onclick="closeRecipeModal()" class="absolute top-4 right-4 w-8 h-8 bg-gray-100 text-gray-500 rounded-full flex items-center justify-center hover:bg-gray-200 transition z-10">
                    <i class="fa-solid fa-xmark"></i>
                </button>

                <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
                
                <div class="flex justify-between items-start mb-4">
                    <div class="pr-8">
                        <span id="modal-tag" class="text-xs font-semibold text-bestie uppercase tracking-wider bg-pink-50 px-2 py-1 rounded-md">Categoria</span>
                        <h2 id="modal-title" class="text-2xl font-bold text-gray-800 mt-2 leading-tight">Nome da Receita</h2>
                    </div>
                    <div class="flex flex-col items-end flex-shrink-0">
                        <span class="text-lg font-bold text-bestie-dark whitespace-nowrap"><span id="modal-cal">0</span> kcal</span>
                    </div>
                </div>
                
                <p id="modal-desc" class="text-sm text-gray-500 mb-6 italic leading-relaxed">
                    <!-- Description injected here -->
                </p>

                <!-- Dica de Ouro Container -->
                <div id="modal-tip-container" class="hidden mb-6 bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                    <h4 class="text-yellow-700 font-bold text-sm mb-1 flex items-center gap-2">
                        <i class="fa-solid fa-star"></i> Dica de Ouro
                    </h4>
                    <p id="modal-tip-text" class="text-xs text-yellow-800"></p>
                </div>

                <div class="flex items-center gap-4 text-sm text-gray-500 mb-6 border-y border-pink-50 py-4 justify-between px-2">
                    <div class="flex items-center gap-1.5">
                        <i class="fa-regular fa-clock text-bestie"></i>
                        <span id="modal-time">0 min</span>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <i class="fa-solid fa-fire text-bestie"></i>
                        <span id="modal-difficulty">F√°cil</span>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <i class="fa-solid fa-user-group text-bestie"></i>
                        <span id="modal-yield">2 por√ß√µes</span>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-basket-shopping text-bestie"></i> Ingredientes
                    </h3>
                    <ul id="modal-ingredients" class="space-y-3 text-sm text-gray-600 pl-2">
                        <!-- JS Inject -->
                    </ul>
                </div>

                <div class="mb-8">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-spoon text-bestie"></i> Modo de Preparo
                    </h3>
                    <div id="modal-instructions" class="space-y-4 text-sm text-gray-600">
                        <!-- JS Inject -->
                    </div>
                </div>
                
                <button class="w-full py-3 bg-bestie text-white font-semibold rounded-xl shadow-lg shadow-pink-200 hover:bg-bestie-dark transition active:scale-95 mb-safe">
                    <i class="fa-regular fa-heart mr-2"></i> Salvar nos Favoritos
                </button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 w-full z-40 bg-white border-t border-pink-100 pb-safe">
        <div class="max-w-md mx-auto px-6 h-16 flex items-center justify-between">
            <button onclick="navigate('home')" class="nav-btn active flex flex-col items-center gap-1 text-bestie">
                <i class="fa-solid fa-house text-xl mb-0.5"></i>
                <span class="text-[10px] font-medium">In√≠cio</span>
            </button>
            <button onclick="navigate('recipes')" class="nav-btn flex flex-col items-center gap-1 text-gray-400 hover:text-bestie transition">
                <i class="fa-solid fa-utensils text-xl mb-0.5"></i>
                <span class="text-[10px] font-medium">Receitas</span>
            </button>
            <div class="relative -top-5">
                <button class="w-12 h-12 rounded-full bg-bestie text-white flex items-center justify-center shadow-lg shadow-pink-300 hover:scale-105 transition">
                    <i class="fa-solid fa-plus text-xl"></i>
                </button>
            </div>
            <button onclick="navigate('calculator')" class="nav-btn flex flex-col items-center gap-1 text-gray-400 hover:text-bestie transition">
                <i class="fa-solid fa-calculator text-xl mb-0.5"></i>
                <span class="text-[10px] font-medium">Calc</span>
            </button>
            <button onclick="navigate('profile')" class="nav-btn flex flex-col items-center gap-1 text-gray-400 hover:text-bestie transition">
                <i class="fa-regular fa-user text-xl mb-0.5"></i>
                <span class="text-[10px] font-medium">Perfil</span>
            </button>
        </div>
    </nav>

    <script>
        // --- GEMINI API SETUP ---
        const apiKey = ""; // Environment will provide key

        // --- USER PROFILE STATE ---
        let userProfile = JSON.parse(localStorage.getItem('bestieProfile')) || {
            name: 'Bestie',
            age: '',
            weight: '',
            targetWeight: '',
            height: '',
            goal: 'perder'
        };

        // --- API FUNCTIONS ---

        async function callGemini(ingredients) {
            const prompt = `Voc√™ √© a 'Bestie Fit', uma chef especialista em receitas saud√°veis, pr√°ticas e com poucas calorias para o aplicativo 'Manual da Bestie'. 
            Crie uma receita criativa e saud√°vel (fit/low carb/proteica) usando OBRIGATORIAMENTE estes ingredientes principais: ${ingredients}. Voc√™ pode sugerir temperos b√°sicos extras.
            
            IMPORTANTE: Responda APENAS com um objeto JSON v√°lido (sem markdown, sem \`\`\`json) seguindo exatamente esta estrutura:
            {
                "title": "Nome Criativo da Receita",
                "calories": 000 (apenas numero),
                "time": "00 min",
                "difficulty": "F√°cil",
                "yield": "1 ou 2 por√ß√µes",
                "description": "Uma descri√ß√£o curta, animada e motivadora estilo 'bestie'. Se houver uma dica especial, comece com 'Dica:'",
                "ingredients": ["ingrediente 1", "ingrediente 2"],
                "instructions": ["passo 1", "passo 2", "passo 3"],
                "category": "almoco" (escolha entre: cafe, almoco, jantar, lanche, doces)
            }`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json"
                }
            };

            try {
                let response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error('Erro na API');

                const data = await response.json();
                let text = data.candidates[0].content.parts[0].text;
                
                text = text.replace(/```json/gi, '').replace(/```/g, '').trim();
                
                return JSON.parse(text);

            } catch (error) {
                console.error("Erro Gemini:", error);
                return null;
            }
        }

        async function callGeminiPlan(userData) {
            const prompt = `Voc√™ √© a 'Bestie Fit', uma nutricionista e coach motivacional. Crie um mini plano personalizado com base nestes dados:
            - Idade: ${userData.age}
            - Peso Atual: ${userData.weight}kg
            - Meta de Peso: ${userData.targetWeight}kg
            - Altura: ${userData.height}cm
            - Objetivo: ${userData.goal}

            IMPORTANTE: Responda APENAS com um objeto JSON v√°lido (sem markdown) com esta estrutura:
            {
                "calories_target": "Ex: 1500-1600",
                "bmi": "Ex: 22.5 (Normal)",
                "macros": {
                    "protein": "Ex: 120g",
                    "carbs": "Ex: 150g",
                    "fats": "Ex: 50g"
                },
                "motivational_quote": "Uma frase curta e inspiradora estilo 'bestie' para motivar.",
                "tip": "Uma dica de ouro espec√≠fica para o objetivo selecionado."
            }`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json"
                }
            };

            try {
                let response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error('Erro na API');

                const data = await response.json();
                let text = data.candidates[0].content.parts[0].text;
                text = text.replace(/```json/gi, '').replace(/```/g, '').trim();
                const firstOpen = text.indexOf('{');
                const lastClose = text.lastIndexOf('}');
                if (firstOpen !== -1 && lastClose !== -1) {
                    text = text.substring(firstOpen, lastClose + 1);
                }
                return JSON.parse(text);
            } catch (error) {
                console.error("Erro Gemini Plan:", error);
                return null;
            }
        }

        async function callGeminiWorkout(data) {
            const prompt = `Voc√™ √© a 'Bestie Fit', uma personal trainer animada e motivadora. Crie um treino r√°pido e eficiente com estas caracter√≠sticas:
            - Tempo: ${data.time} minutos
            - Foco: ${data.focus}
            - Equipamento: ${data.equipment}

            IMPORTANTE: Responda APENAS com um objeto JSON v√°lido (sem markdown) com esta estrutura:
            {
                "title": "Nome Criativo do Treino",
                "warmup": "Uma frase r√°pida de aquecimento (Ex: 1 min polichinelos)",
                "exercises": [
                    { "name": "Nome do Exerc√≠cio", "reps": "Ex: 3x 12", "tips": "Dica r√°pida de execu√ß√£o" },
                    { "name": "Nome do Exerc√≠cio 2", "reps": "Ex: 3x 15", "tips": "Dica r√°pida" }
                ],
                "motivation": "Frase final de motiva√ß√£o curta e divertida"
            }`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json"
                }
            };

            try {
                let response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error('Erro na API');

                const data = await response.json();
                let text = data.candidates[0].content.parts[0].text;
                text = text.replace(/```json/gi, '').replace(/```/g, '').trim();
                const firstOpen = text.indexOf('{');
                const lastClose = text.lastIndexOf('}');
                if (firstOpen !== -1 && lastClose !== -1) {
                    text = text.substring(firstOpen, lastClose + 1);
                }
                return JSON.parse(text);
            } catch (error) {
                console.error("Erro Gemini Workout:", error);
                return null;
            }
        }

        async function callGeminiSOS(situation) {
            const prompt = `Voc√™ √© a 'Bestie Fit', a melhor amiga virtual da usu√°ria. A usu√°ria est√° passando por esta situa√ß√£o: "${situation}".
            D√™ um conselho de emerg√™ncia curto, pr√°tico e sem julgamentos (max 2 frases).
            Foque em redu√ß√£o de danos ou motiva√ß√£o imediata. Use tom leve e divertido com emojis.`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                let response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error('Erro na API');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Erro Gemini SOS:", error);
                return "Oii bestie! T√¥ aqui, respira fundo! Tenta de novo j√° j√°! üíñ";
            }
        }

        async function callGeminiSwap(item) {
            const prompt = `Voc√™ √© a 'Bestie Fit'. A usu√°ria quer substituir '${item}' por algo mais saud√°vel na dieta.
            Sugira a melhor troca fit e explique o porqu√™ em uma frase curta, animada e com emojis. Exemplo: 'Troque por X, porque Y! ‚ú®'`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                let response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error('Erro na API');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Erro Gemini Swap:", error);
                return "Ops! Minha bola de cristal fit falhou. Tenta de novo! üîÆ";
            }
        }

        // --- DATA ---
        let waterIntake = 0;
        let waterGoalLiters = 2.5;
        let waterGoalCups = 10;

        const recipes = [
            // All 40 recipes embedded here
            { id: 1, title: "Crepioca Fit", displayCategory: "Caf√© da Manh√£", tags: ['cafe', 'proteina', 'zeroacucar', 'simples', 'rapido', 'lowcal'], calories: 180, time: "10 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "A queridinha das dietas! Pr√°tica, r√°pida e vers√°til.", ingredients: ["1 ovo", "2 colheres goma tapioca", "1 colher requeij√£o light"], instructions: ["Bata o ovo com a tapioca.", "Frite em frigideira untada."] },
            { id: 2, title: "Salada de Pote", displayCategory: "Almo√ßo Pr√°tico", tags: ['almoco', 'jantar', 'lowcal', 'lowcarb'], calories: 320, time: "15 min", difficulty: "F√°cil", yield: "1 pote", description: "Perfeita para levar para o trabalho.", ingredients: ["Folhas", "100g frango desfiado", "Legumes"], instructions: ["Molho no fundo.", "Ingredientes em camadas."] },
            { id: 3, title: "Overnight Oats", displayCategory: "Caf√©/Lanche", tags: ['cafe', 'lanche', 'vegetariano'], calories: 250, time: "5 min", difficulty: "Muito F√°cil", yield: "1 pote", description: "Caf√© da manh√£ pronto para quem acorda na correria.", ingredients: ["30g aveia", "Leite vegetal", "Chia", "Frutas"], instructions: ["Misture e gele a noite toda."] },
            { id: 4, title: "Brigadeiro de Whey", displayCategory: "Doce Fit", tags: ['lanche', 'proteina', 'doces'], calories: 120, time: "15 min", difficulty: "F√°cil", yield: "5 bolinhas", description: "Para matar a vontade de doce sem sair da dieta.", ingredients: ["Whey Chocolate", "Cacau", "Leite em p√≥", "√Ågua"], instructions: ["Misture at√© dar ponto."] },
            { id: 5, title: "Panqueca de Banana", displayCategory: "Caf√© da Manh√£", tags: ['cafe', 'lanche', 'lowfat'], calories: 210, time: "10 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Apenas 3 ingredientes.", ingredients: ["1 banana", "2 ovos", "Canela"], instructions: ["Amasse banana, misture com ovos, frite."] },
            { id: 6, title: "Br√≥colis e couve-flor", displayCategory: "Almo√ßo/Jantar", tags: ['almoco', 'jantar', 'lowcarb'], calories: 356, time: "25 min", difficulty: "Normal", yield: "2 por√ß√µes", description: "Gratinado delicioso.", ingredients: ["Br√≥colis", "Couve-flor", "Queijo", "Creme de leite"], instructions: ["Cozinhe legumes, cubra com molho e asse."] },
            { id: 7, title: "Lassi de Manga", displayCategory: "Caf√© da Manh√£", tags: ['cafe', 'lanche', 'vegetariano'], calories: 211, time: "3 min", difficulty: "Muito F√°cil", yield: "2 por√ß√µes", description: "Bebida refrescante.", ingredients: ["Manga", "Iogurte", "Mel"], instructions: ["Bata tudo no liquidificador."] },
            { id: 8, title: "Shake Choco Hortel√£", displayCategory: "Caf√©/Lanche", tags: ['cafe', 'lanche', 'vegano'], calories: 232, time: "3 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "Refrescante e doce.", ingredients: ["Cacau", "Hortel√£", "Banana", "Leite vegetal"], instructions: ["Bata tudo no liquidificador."] },
            { id: 9, title: "Smoothie Morango", displayCategory: "Caf√©/Lanche", tags: ['cafe', 'lanche', 'lowcal'], calories: 150, time: "5 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "Cl√°ssico.", ingredients: ["Morango", "Banana", "Iogurte"], instructions: ["Bata tudo."] },
            { id: 10, title: "Shake Banana Nozes", displayCategory: "P√≥s-Treino", tags: ['cafe', 'proteina'], calories: 434, time: "5 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Energia pura.", ingredients: ["Banana", "Nozes", "Iogurte", "Mel"], instructions: ["Bata tudo."] },
            { id: 11, title: "Shake Pasta Amendoim", displayCategory: "Proteico", tags: ['lanche', 'proteina'], calories: 402, time: "5 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Favorito dos atletas.", ingredients: ["Pasta de amendoim", "Banana", "Whey", "Leite"], instructions: ["Bata tudo."] },
            { id: 12, title: "Smoothie Banana T√¢mara", displayCategory: "Caf√©/Lanche", tags: ['cafe', 'vegano'], calories: 237, time: "15 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "Ado√ßado naturalmente.", ingredients: ["Banana", "T√¢maras", "Leite vegetal"], instructions: ["Hidrate t√¢maras, bata tudo."] },
            { id: 13, title: "Shake Mirtilo Coco", displayCategory: "Proteico Caseiro", tags: ['lanche', 'proteina'], calories: 358, time: "5 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Prote√≠na sem p√≥.", ingredients: ["Iogurte Grego", "Mirtilo", "Coco"], instructions: ["Bata tudo."] },
            { id: 14, title: "Shake Frutas Vermelhas", displayCategory: "P√≥s-Treino", tags: ['lanche', 'lowcal'], calories: 163, time: "9 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Leve e proteico.", ingredients: ["Claras", "Frutas vermelhas", "Iogurte"], instructions: ["Bata tudo."] },
            { id: 15, title: "Shake Chocolate Prot", displayCategory: "Pr√©-Treino", tags: ['lanche', 'proteina'], calories: 284, time: "5 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "R√°pido e delicioso.", ingredients: ["Banana", "Whey", "Cacau", "√Ågua"], instructions: ["Bata tudo."] },
            { id: 16, title: "Mingau Aveia Choco", displayCategory: "Caf√© Vegano", tags: ['cafe', 'vegano'], calories: 389, time: "10 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Saciante.", ingredients: ["Aveia", "Cacau", "Banana", "Leite veg"], instructions: ["Cozinhe at√© engrossar."] },
            { id: 17, title: "Cereal Caseiro", displayCategory: "Caf√©/Lanche", tags: ['cafe', 'lowcarb'], calories: 455, time: "85 min", difficulty: "Normal", yield: "4 por√ß√µes", description: "Crocante e saud√°vel.", ingredients: ["Am√™ndoas", "Coco", "Sementes"], instructions: ["Asse em forno baixo."] },
            { id: 18, title: "Overnight Framboesa", displayCategory: "Caf√© Pr√°tico", tags: ['cafe', 'simples'], calories: 286, time: "3h+", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Prepare antes.", ingredients: ["Aveia", "Framboesa", "Leite"], instructions: ["Misture e gele."] },
            { id: 19, title: "Mingau Microondas", displayCategory: "Caf√© R√°pido", tags: ['cafe', 'rapido'], calories: 373, time: "8 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Muito pr√°tico.", ingredients: ["Aveia", "Banana", "√Ågua/Leite"], instructions: ["Microondas 2 min."] },
            { id: 20, title: "Smoothie Verde", displayCategory: "Detox", tags: ['lanche', 'vegano'], calories: 273, time: "5 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Vitaminas.", ingredients: ["Espinafre", "Laranja", "Banana"], instructions: ["Bata tudo."] },
            { id: 21, title: "Cereal Trigo", displayCategory: "Caf√© Caseiro", tags: ['cafe', 'simples'], calories: 413, time: "15 min", difficulty: "Normal", yield: "1 por√ß√£o", description: "Cereal assado.", ingredients: ["Trigo", "Mel", "√ìleo coco"], instructions: ["Asse at√© dourar."] },
            { id: 22, title: "Bruschetta Avocado", displayCategory: "Lanche Salgado", tags: ['lanche', 'vegano'], calories: 427, time: "15 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "Refinado.", ingredients: ["P√£o integral", "Avocado", "Tomate"], instructions: ["Monte no p√£o tostado."] },
            { id: 23, title: "Misto Batata Doce", displayCategory: "Pr√©-Treino", tags: ['lanche', 'vegano'], calories: 303, time: "28 min", difficulty: "F√°cil", yield: "3 por√ß√µes", description: "Substituto do p√£o.", ingredients: ["Batata doce", "Pasta amendoim"], instructions: ["Asse batata, recheie."] },
            { id: 24, title: "Geleia Morango Chia", displayCategory: "Doce Fit", tags: ['doces', 'lowcal'], calories: 12, time: "15 min", difficulty: "F√°cil", yield: "20 por√ß√µes", description: "Sem a√ß√∫car.", ingredients: ["Morango", "Chia", "Ado√ßante"], instructions: ["Cozinhe at√© reduzir."] },
            { id: 25, title: "Sandu√≠che Tomate Ovos", displayCategory: "Caf√© Pr√°tico", tags: ['cafe', 'almoco'], calories: 240, time: "15 min", difficulty: "Normal", yield: "2 por√ß√µes", description: "Cl√°ssico.", ingredients: ["P√£o integral", "Ovo", "Tomate", "Iogurte"], instructions: ["Fa√ßa pasta de ovo, monte."] },
            { id: 26, title: "Rabanada Morango", displayCategory: "Caf√© Especial", tags: ['cafe', 'doces'], calories: 260, time: "10 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "Vers√£o fit.", ingredients: ["P√£o", "Ovo", "Leite", "Morango"], instructions: ["Molhe p√£o, grelhe."] },
            { id: 27, title: "Triguilho Framboesa", displayCategory: "Caf√© Energia", tags: ['cafe', 'rapido'], calories: 467, time: "10 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Fibras.", ingredients: ["Triguilho", "Iogurte", "Frutas"], instructions: ["Misture."] },
            { id: 28, title: "Ovos Mexidos Espinafre", displayCategory: "Caf√© Low Carb", tags: ['cafe', 'lowcarb'], calories: 546, time: "10 min", difficulty: "F√°cil", yield: "1 por√ß√£o", description: "Salgado.", ingredients: ["Ovos", "Espinafre", "Feta"], instructions: ["Refogue e mexa."] },
            { id: 29, title: "Muffin Banana Choco", displayCategory: "Doce Fit", tags: ['lanche', 'doces'], calories: 152, time: "25 min", difficulty: "F√°cil", yield: "9 por√ß√µes", description: "Lanche.", ingredients: ["Banana", "Farinha", "Chocolate"], instructions: ["Asse em forminhas."] },
            { id: 30, title: "Muffins Salgados", displayCategory: "Caf√© Proteico", tags: ['cafe', 'proteina'], calories: 41, time: "35 min", difficulty: "F√°cil", yield: "9 por√ß√µes", description: "Ovos.", ingredients: ["Ovos", "Vegetais"], instructions: ["Asse em forminhas."] },
            { id: 31, title: "Panqueca Salgada", displayCategory: "Caf√© Proteico", tags: ['cafe', 'almoco'], calories: 476, time: "15 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "Aveia.", ingredients: ["Aveia", "Ovos", "Recheio"], instructions: ["Fa√ßa disco, recheie."] },
            { id: 32, title: "Ovos Presunto", displayCategory: "Caf√© Salgado", tags: ['cafe', 'lowcarb'], calories: 230, time: "25 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "B√°sico.", ingredients: ["Ovos", "Presunto", "Espinafre"], instructions: ["Refogue e mexa."] },
            { id: 33, title: "Sufl√™ Mirtilo", displayCategory: "Caf√©/Lanche", tags: ['cafe', 'doces'], calories: 300, time: "65 min", difficulty: "F√°cil", yield: "3 por√ß√µes", description: "Quente ou frio.", ingredients: ["Iogurte", "Ovos", "Mirtilo"], instructions: ["Asse."] },
            { id: 34, title: "Wrap Omelete", displayCategory: "Almo√ßo/Jantar", tags: ['almoco', 'lowcarb'], calories: 352, time: "20 min", difficulty: "Normal", yield: "4 por√ß√µes", description: "Sem farinha.", ingredients: ["Ovos", "Recheio"], instructions: ["Fa√ßa disco de ovo, enrole."] },
            { id: 35, title: "Wrap Morango", displayCategory: "Doce Fit", tags: ['lanche', 'doces'], calories: 297, time: "10 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "Doce.", ingredients: ["Tortilha", "Cream cheese", "Morango"], instructions: ["Recheie e enrole."] },
            { id: 36, title: "Rolinhos Piment√£o", displayCategory: "Lanche Leve", tags: ['lanche', 'lowcal'], calories: 353, time: "10 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "Frio.", ingredients: ["Tortilha", "Piment√£o", "Cream cheese"], instructions: ["Recheie e corte."] },
            { id: 37, title: "Omelete Coreano", displayCategory: "Caf√©/Almo√ßo", tags: ['cafe', 'almoco'], calories: 303, time: "12 min", difficulty: "F√°cil", yield: "2 por√ß√µes", description: "Enrolado.", ingredients: ["Ovos", "Cenoura"], instructions: ["Frite enrolando."] },
            { id: 38, title: "P√£o Low Carb", displayCategory: "Caf√©/Lanche", tags: ['cafe', 'lowcarb'], calories: 165, time: "75 min", difficulty: "Normal", yield: "10 fatias", description: "Am√™ndoas.", ingredients: ["Farinha am√™ndoa", "Ovos"], instructions: ["Asse."] },
            { id: 39, title: "Ovos com Salm√£o", displayCategory: "Caf√© Proteico", tags: ['cafe', 'proteina'], calories: 500, time: "15 min", difficulty: "Normal", yield: "2 por√ß√µes", description: "Sofisticado.", ingredients: ["Ovos", "Salm√£o defumado"], instructions: ["Mexa tudo."] },
            { id: 40, title: "Sandu√≠che Peru", displayCategory: "Lanche Pr√°tico", tags: ['lanche', 'rapido'], calories: 313, time: "15 min", difficulty: "Normal", yield: "4 por√ß√µes", description: "Completo.", ingredients: ["P√£o integral", "Peito peru", "Salada"], instructions: ["Monte."] }
        ];

        // --- FUNCTIONS ---

        const views = {
            home: `
                <div class="fade-in space-y-6">
                    <div class="bg-gradient-to-r from-bestie to-pink-400 rounded-3xl p-6 text-white shadow-lg shadow-pink-200">
                        <p class="text-pink-100 text-sm font-medium mb-1">Bom dia, Bestie! ‚ú®</p>
                        <h2 class="text-2xl font-bold mb-4">Vamos secar hoje?</h2>
                        <div class="flex gap-3">
                            <div class="bg-white/20 backdrop-blur rounded-xl p-3 flex-1">
                                <span class="block text-xs text-pink-100">√Ågua</span>
                                <span class="font-bold text-lg">1.2L</span>
                            </div>
                            <div class="bg-white/20 backdrop-blur rounded-xl p-3 flex-1">
                                <span class="block text-xs text-pink-100">Meta</span>
                                <span class="font-bold text-lg">55kg</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-lg text-gray-800">Atalhos</h3>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <!-- Existing Recipes -->
                            <button onclick="navigate('recipes')" class="bg-white p-4 rounded-2xl shadow-sm border border-pink-50 flex flex-col items-center gap-2 hover:border-bestie transition group">
                                <div class="w-12 h-12 rounded-full bg-green-100 text-green-500 flex items-center justify-center group-hover:scale-110 transition">
                                    <i class="fa-solid fa-leaf"></i>
                                </div>
                                <span class="font-medium text-sm">Receitinhas</span>
                            </button>
                            <!-- Water (Visual) -->
                            <button onclick="navigate('water')" class="bg-white p-4 rounded-2xl shadow-sm border border-pink-50 flex flex-col items-center gap-2 hover:border-bestie transition group">
                                <div class="w-12 h-12 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center group-hover:scale-110 transition">
                                    <i class="fa-solid fa-glass-water"></i>
                                </div>
                                <span class="font-medium text-sm">√Ågua</span>
                            </button>
                            
                            <!-- Fim de Semana -->
                            <button onclick="navigate('weekend')" class="bg-white p-4 rounded-2xl shadow-sm border border-pink-50 flex flex-col items-center gap-2 hover:border-bestie transition group">
                                <div class="w-12 h-12 rounded-full bg-purple-100 text-purple-500 flex items-center justify-center group-hover:scale-110 transition">
                                    <i class="fa-solid fa-calendar-check"></i>
                                </div>
                                <span class="font-medium text-sm">Fim de Semana</span>
                            </button>

                            <!-- Kit da Bestie -->
                            <button onclick="navigate('kit')" class="bg-white p-4 rounded-2xl shadow-sm border border-pink-50 flex flex-col items-center gap-2 hover:border-bestie transition group">
                                <div class="w-12 h-12 rounded-full bg-teal-100 text-teal-500 flex items-center justify-center group-hover:scale-110 transition">
                                    <i class="fa-solid fa-kit-medical"></i>
                                </div>
                                <span class="font-medium text-sm">Kit da Bestie</span>
                            </button>

                            <!-- Trocas -->
                            <button onclick="navigate('swaps')" class="bg-white p-4 rounded-2xl shadow-sm border border-pink-50 flex flex-col items-center gap-2 hover:border-bestie transition group">
                                <div class="w-12 h-12 rounded-full bg-orange-100 text-orange-500 flex items-center justify-center group-hover:scale-110 transition">
                                    <i class="fa-solid fa-repeat"></i>
                                </div>
                                <span class="font-medium text-sm">Trocas</span>
                            </button>

                            <!-- Economia -->
                            <button onclick="navigate('savings')" class="bg-white p-4 rounded-2xl shadow-sm border border-pink-50 flex flex-col items-center gap-2 hover:border-bestie transition group">
                                <div class="w-12 h-12 rounded-full bg-yellow-100 text-yellow-500 flex items-center justify-center group-hover:scale-110 transition">
                                    <i class="fa-solid fa-piggy-bank"></i>
                                </div>
                                <span class="font-medium text-sm">Economia</span>
                            </button>

                            <!-- Treino -->
                            <button onclick="navigate('workout')" class="bg-white p-4 rounded-2xl shadow-sm border border-pink-50 flex flex-col items-center gap-2 hover:border-bestie transition group">
                                <div class="w-12 h-12 rounded-full bg-red-100 text-red-500 flex items-center justify-center group-hover:scale-110 transition">
                                    <i class="fa-solid fa-dumbbell"></i>
                                </div>
                                <span class="font-medium text-sm">Treino</span>
                            </button>

                            <!-- SOS Bestie (New) -->
                            <button onclick="navigate('sos')" class="bg-white p-4 rounded-2xl shadow-sm border border-pink-50 flex flex-col items-center gap-2 hover:border-bestie transition group">
                                <div class="w-12 h-12 rounded-full bg-indigo-100 text-indigo-500 flex items-center justify-center group-hover:scale-110 transition">
                                    <i class="fa-solid fa-bell"></i>
                                </div>
                                <span class="font-medium text-sm">SOS Bestie</span>
                            </button>
                        </div>
                    </div>
                </div>
            `,
            weekend: `
                <div class="fade-in pb-20">
                    <div class="mb-6 flex items-center gap-3">
                        <button onclick="navigate('home')" class="w-8 h-8 rounded-full bg-pink-50 text-bestie flex items-center justify-center hover:bg-pink-100 transition">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">Fim de Semana (S√°bado e Domingo) üçï</h2>
                    </div>
                    <div class="bg-white rounded-3xl p-6 shadow-sm border border-pink-100 space-y-4">
                        <div class="bg-purple-50 rounded-xl p-4 border border-purple-100">
                            <h3 class="font-bold text-purple-700 mb-2">Regra de Ouro</h3>
                            <p class="text-sm text-gray-600">Escolha <strong>2 refei√ß√µes livres</strong> no fim de semana (S√°bado ou Domingo) para comer o que tem vontade!</p>
                        </div>
                        <ul class="space-y-3 text-sm text-gray-600">
                            <li class="flex items-start gap-3"><i class="fa-solid fa-check text-green-500 mt-1"></i><span>Volte para o plano na pr√≥xima refei√ß√£o.</span></li>
                            <li class="flex items-start gap-3"><i class="fa-solid fa-check text-green-500 mt-1"></i><span>Beba bastante √°gua antes e depois.</span></li>
                            <li class="flex items-start gap-3"><i class="fa-solid fa-check text-green-500 mt-1"></i><span>Coma devagar e aproveite cada mordida!</span></li>
                        </ul>
                    </div>
                </div>
            `,
            water: `
                <div class="fade-in pb-20 pt-6">
                    <div class="mb-6 flex items-center gap-3">
                        <button onclick="navigate('home')" class="w-8 h-8 rounded-full bg-pink-50 text-bestie flex items-center justify-center hover:bg-pink-100 transition">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">Hidrata√ß√£o üíß</h2>
                    </div>
                    
                    <div class="text-center mb-8">
                        <div class="relative w-40 h-40 mx-auto mb-4 bg-blue-50 rounded-full flex items-center justify-center border-4 border-white shadow-lg overflow-hidden">
                            <div id="water-level" class="absolute bottom-0 left-0 w-full bg-blue-400 transition-all duration-500 ease-out" style="height: 0%"></div>
                            <span id="water-count" class="relative text-3xl font-bold text-blue-600 z-10">0</span>
                            <span class="relative text-xs text-blue-400 mt-8 -ml-4 z-10" id="water-goal-total-cups">/10</span>
                        </div>
                        <p class="text-gray-500 text-sm">Meta Di√°ria: <span id="water-goal-liters" class="font-bold text-blue-600">2.5L</span></p>
                        <p class="text-xs text-gray-400 mt-1">(Baseado no seu peso: 35ml/kg)</p>
                    </div>

                    <div class="flex justify-center gap-6">
                        <button onclick="updateWater(-1)" class="w-14 h-14 rounded-full bg-white border border-gray-200 text-gray-400 flex items-center justify-center text-xl shadow-sm hover:scale-105 transition">
                            <i class="fa-solid fa-minus"></i>
                        </button>
                        <button onclick="updateWater(1)" class="w-14 h-14 rounded-full bg-blue-500 text-white flex items-center justify-center text-xl shadow-lg shadow-blue-200 hover:scale-105 transition">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>

                    <div class="mt-8 bg-blue-50 rounded-2xl p-5 border border-blue-100 mx-4">
                        <h3 class="font-bold text-blue-800 text-sm mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-circle-info"></i> Por que beber √°gua?
                        </h3>
                        <p class="text-xs text-blue-700 leading-relaxed">
                            A √°gua ajuda a controlar o apetite, melhora a pele e aumenta o metabolismo. Tente beber pelo menos 2.5L por dia!
                        </p>
                    </div>
                </div>
            `,
            savings: `
                <div class="fade-in pb-20">
                    <div class="mb-6 flex items-center gap-3">
                        <button onclick="navigate('home')" class="w-8 h-8 rounded-full bg-pink-50 text-bestie flex items-center justify-center hover:bg-pink-100 transition">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">Economia üí∞</h2>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-100 rounded-3xl p-6 shadow-sm mb-6">
                        <h3 class="font-bold text-yellow-700 text-lg mb-2 flex items-center gap-2">
                            <i class="fa-solid fa-star"></i> Dica de Ouro
                        </h3>
                        <p class="text-sm text-yellow-800 leading-relaxed">
                            Para economizar de verdade, compre suplementos em <strong>sites de atacado</strong> ou procure por <strong>cupons de influencers</strong>. 
                            <br><br>
                            Para alimentos frescos, v√° √† <strong>feira local no final do dia</strong> (a "xepa") onde os pre√ßos despencam!
                        </p>
                    </div>

                    <div class="space-y-3">
                        <div class="bg-white p-4 rounded-2xl border border-pink-50 flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-600">Granel</span>
                            <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-lg">Mais Barato</span>
                        </div>
                        <div class="bg-white p-4 rounded-2xl border border-pink-50 flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-600">Marcas de Supermercado</span>
                            <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-lg">Custo-Benef√≠cio</span>
                        </div>
                        <div class="bg-white p-4 rounded-2xl border border-pink-50 flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-600">Congelados</span>
                            <span class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-lg">Duram Mais</span>
                        </div>
                    </div>
                </div>
            `,
            kit: `
                <div class="fade-in pb-20">
                    <div class="mb-6 flex items-center gap-3">
                        <button onclick="navigate('home')" class="w-8 h-8 rounded-full bg-pink-50 text-bestie flex items-center justify-center hover:bg-pink-100 transition">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">Kit da Bestie üíä</h2>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-white rounded-2xl p-4 shadow-sm border border-pink-50 flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center text-xl">üí™</div>
                            <div>
                                <h3 class="font-bold text-gray-800">Whey Protein</h3>
                                <p class="text-xs text-gray-500">P√≥s-treino ou lanches r√°pidos.</p>
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl p-4 shadow-sm border border-pink-50 flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-green-50 text-green-500 flex items-center justify-center text-xl">‚ö°</div>
                            <div>
                                <h3 class="font-bold text-gray-800">Creatina</h3>
                                <p class="text-xs text-gray-500">3g a 5g todo dia (sem falhar!).</p>
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl p-4 shadow-sm border border-pink-50 flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-yellow-50 text-yellow-500 flex items-center justify-center text-xl">üåû</div>
                            <div>
                                <h3 class="font-bold text-gray-800">Multivitam√≠nico</h3>
                                <p class="text-xs text-gray-500">Pela manh√£, junto com o caf√©.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            swaps: `
                <div class="fade-in pb-20">
                    <div class="mb-6 flex items-center gap-3">
                        <button onclick="navigate('home')" class="w-8 h-8 rounded-full bg-pink-50 text-bestie flex items-center justify-center hover:bg-pink-100 transition">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">Trocas Inteligentes üîÑ</h2>
                    </div>
                    
                    <!-- New AI Feature: Smart Swap Search -->
                    <div class="bg-gradient-to-br from-orange-50 to-pink-50 border border-orange-100 rounded-3xl p-6 shadow-sm mb-6">
                        <p class="text-gray-600 text-sm mb-4 font-medium">Quer substituir algo espec√≠fico? Pergunte pra Bestie Fit! ü•ï</p>
                        
                        <div class="relative">
                            <input type="text" id="swap-input" placeholder="Ex: P√£o franc√™s, Coxinha, Refri..." class="w-full bg-white border border-orange-200 rounded-2xl p-4 text-sm focus:outline-none focus:border-bestie focus:ring-1 focus:ring-bestie transition placeholder-gray-400">
                            <button onclick="generateSwap()" id="swap-btn" class="absolute right-2 top-2 bg-orange-400 text-white p-2 rounded-xl hover:bg-orange-500 transition shadow-md">
                                <i class="fa-solid fa-magnifying-glass"></i>
                            </button>
                        </div>

                        <div id="swap-result" class="hidden mt-4 bg-white rounded-xl p-4 border border-orange-100 shadow-sm animate-fade-in">
                            <h4 class="font-bold text-orange-600 text-sm mb-1 flex items-center gap-2">
                                <i class="fa-solid fa-leaf"></i> Sugest√£o da Bestie
                            </h4>
                            <p id="swap-text" class="text-sm text-gray-600 italic"></p>
                        </div>
                    </div>

                    <div class="bg-white rounded-3xl overflow-hidden shadow-sm border border-pink-100">
                         <div class="p-4 bg-pink-50 border-b border-pink-100">
                            <h3 class="font-bold text-gray-700 text-sm">Trocas Populares</h3>
                        </div>
                        <table class="w-full text-sm text-left text-gray-600">
                            <thead class="bg-white text-gray-400 uppercase text-xs border-b border-gray-100">
                                <tr>
                                    <th class="px-4 py-3 font-medium">Troque Isso</th>
                                    <th class="px-4 py-3 font-medium">Por Isso</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-50">
                                <tr><td class="px-4 py-3">A√ß√∫car</td><td class="px-4 py-3 font-medium text-green-600">Ado√ßante (Stevia/Xilitol)</td></tr>
                                <tr><td class="px-4 py-3">√ìleo de Soja</td><td class="px-4 py-3 font-medium text-green-600">Azeite de Oliva</td></tr>
                                <tr><td class="px-4 py-3">Refrigerante</td><td class="px-4 py-3 font-medium text-green-600">√Ågua com G√°s e Lim√£o</td></tr>
                                <tr><td class="px-4 py-3">P√£o Branco</td><td class="px-4 py-3 font-medium text-green-600">P√£o Integral / Tapioca</td></tr>
                                <tr><td class="px-4 py-3">Creme de Leite</td><td class="px-4 py-3 font-medium text-green-600">Iogurte Grego / Creme de Ricota</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `,
            recipes: `
                <div class="fade-in">
                    <div class="mb-6 flex justify-between items-end">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Receitinhas ü•ó</h2>
                            <p class="text-gray-500 text-sm">Coma bem sem culpa!</p>
                        </div>
                        <button onclick="navigate('chefBestie')" class="bg-gradient-to-r from-bestie to-pink-400 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg shadow-pink-200 hover:scale-105 transition flex items-center gap-2 animate-pulse">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> Chef Bestie
                        </button>
                    </div>

                    <!-- Search -->
                    <div class="relative mb-6">
                        <i class="fa-solid fa-search absolute left-4 top-3.5 text-gray-400 text-sm"></i>
                        <input type="text" placeholder="O que vamos cozinhar?" class="w-full bg-white border border-pink-100 rounded-full py-3 pl-10 pr-4 text-sm focus:outline-none focus:border-bestie focus:ring-1 focus:ring-bestie transition placeholder-gray-400 shadow-sm">
                    </div>

                    <!-- Categories / Filters -->
                    <div class="flex gap-2 overflow-x-auto hide-scrollbar mb-6 pb-2 px-1">
                        <button onclick="filterRecipes('all', this)" class="cat-btn active flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-bestie text-white shadow-md shadow-pink-200 transition">Tudo</button>
                        
                        <!-- Refei√ß√µes -->
                        <button onclick="filterRecipes('cafe', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Caf√© da Manh√£</button>
                        <button onclick="filterRecipes('almoco', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Almo√ßo</button>
                        <button onclick="filterRecipes('jantar', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Jantar</button>
                        
                        <!-- Dietas -->
                        <button onclick="filterRecipes('lowcarb', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Baixo Carboidrato</button>
                        <button onclick="filterRecipes('proteina', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Rico em Prote√≠nas</button>
                        <button onclick="filterRecipes('lowcal', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Baixa Caloria</button>
                        <button onclick="filterRecipes('lowfat', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Baixa Gordura</button>
                        <button onclick="filterRecipes('zeroacucar', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Sem A√ß√∫car</button>
                        
                        <!-- Prefer√™ncias -->
                        <button onclick="filterRecipes('vegano', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Vegano</button>
                        <button onclick="filterRecipes('vegetariano', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Vegetariano</button>
                        
                        <!-- Praticidade -->
                        <button onclick="filterRecipes('simples', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Poucos Ingredientes</button>
                        <button onclick="filterRecipes('rapido', this)" class="cat-btn flex-shrink-0 px-4 py-2 rounded-full text-xs font-semibold bg-white text-gray-500 border border-pink-100 hover:border-bestie hover:text-bestie transition">Preparo R√°pido</button>
                    </div>

                    <!-- Recipe Grid -->
                    <div id="recipe-grid" class="grid grid-cols-1 gap-4 pb-20">
                        <!-- Filled by JS -->
                    </div>
                </div>
            `,
            chefBestie: `
                <div class="fade-in pb-20">
                    <div class="mb-6 flex items-center gap-3">
                        <button onclick="navigate('recipes')" class="w-8 h-8 rounded-full bg-pink-50 text-bestie flex items-center justify-center hover:bg-pink-100 transition">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">Chef Bestie ‚ú®</h2>
                    </div>

                    <div class="bg-gradient-to-br from-purple-50 to-pink-50 border border-pink-100 rounded-3xl p-6 shadow-sm mb-6">
                        <p class="text-gray-600 text-sm mb-4">Me conte o que voc√™ tem na geladeira e eu crio uma receitinha m√°gica pra voc√™!</p>
                        
                        <div class="relative">
                            <textarea id="ai-ingredients" rows="3" placeholder="Ex: frango, batata doce, br√≥colis..." class="w-full bg-white border border-pink-200 rounded-2xl p-4 text-sm focus:outline-none focus:border-bestie focus:ring-1 focus:ring-bestie transition placeholder-gray-400 resize-none"></textarea>
                            <div class="absolute bottom-3 right-3 text-xs text-gray-400">
                                <i class="fa-solid fa-carrot"></i>
                            </div>
                        </div>

                        <button onclick="generateAIRecipe()" id="generate-btn" class="w-full mt-4 bg-gradient-to-r from-bestie to-pink-400 text-white py-3 rounded-xl font-bold shadow-lg shadow-pink-200 hover:scale-[1.02] transition active:scale-95 flex items-center justify-center gap-2">
                            <span>Criar Receita M√°gica</span>
                            <i class="fa-solid fa-wand-magic-sparkles"></i>
                        </button>
                    </div>

                    <div id="ai-result" class="hidden space-y-4">
                        <div class="flex items-center gap-2 text-sm text-gray-400 uppercase font-bold tracking-wider mb-2">
                            <i class="fa-solid fa-star text-yellow-400"></i> Resultado
                        </div>
                        <!-- Recipe Card Container -->
                        <div id="ai-recipe-card"></div>
                    </div>
                </div>
            `,
            calculator: `
                 <div class="fade-in pb-20 pt-6">
                    <div class="mb-6 text-center">
                        <div class="w-16 h-16 bg-pink-100 text-bestie rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce">
                            <i class="fa-solid fa-wand-magic-sparkles text-2xl"></i>
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">Calculadora M√°gica ‚ú®</h2>
                        <p class="text-gray-500 mt-2 text-sm">Descubra suas metas ideais!</p>
                    </div>

                    <div class="bg-white rounded-3xl p-6 shadow-sm border border-pink-100 space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Idade</label>
                                <input type="number" id="calc-age" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition" placeholder="Ex: 25">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Peso Atual (kg)</label>
                                <input type="number" id="calc-weight" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition" placeholder="Ex: 60">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Altura (cm)</label>
                                <input type="number" id="calc-height" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition" placeholder="Ex: 165">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Meta de Peso (kg)</label>
                                <input type="number" id="calc-target-weight" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition" placeholder="Ex: 55">
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Objetivo</label>
                            <select id="calc-goal" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition text-gray-600">
                                <option value="perder">Secar (Perder Peso)</option>
                                <option value="manter">Manter Peso</option>
                                <option value="ganhar">Ganhar Massa (Hipertrofia)</option>
                            </select>
                        </div>

                        <button onclick="generatePlan()" id="plan-btn" class="w-full mt-4 bg-bestie text-white py-3 rounded-xl font-bold shadow-lg shadow-pink-200 hover:scale-[1.02] transition active:scale-95">
                            Gerar Plano Personalizado ‚ú®
                        </button>
                    </div>

                    <div id="plan-result" class="hidden mt-6 space-y-4">
                        <div class="bg-gradient-to-r from-bestie to-pink-400 rounded-3xl p-6 text-white shadow-lg relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full -mr-10 -mt-10"></div>
                            
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-bullseye"></i> Sua Meta Di√°ria
                            </h3>
                            
                            <div class="text-4xl font-bold mb-1" id="plan-calories">0000</div>
                            <div class="text-pink-100 text-sm mb-4">kcal / dia</div>
                            
                            <div class="flex gap-2 text-center">
                                <div class="bg-white/20 backdrop-blur rounded-xl p-2 flex-1">
                                    <span class="block text-xs text-pink-100">Prot</span>
                                    <span class="font-bold" id="plan-protein">0g</span>
                                </div>
                                <div class="bg-white/20 backdrop-blur rounded-xl p-2 flex-1">
                                    <span class="block text-xs text-pink-100">Carb</span>
                                    <span class="font-bold" id="plan-carbs">0g</span>
                                </div>
                                <div class="bg-white/20 backdrop-blur rounded-xl p-2 flex-1">
                                    <span class="block text-xs text-pink-100">Gord</span>
                                    <span class="font-bold" id="plan-fats">0g</span>
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-center text-pink-100 bg-black/10 rounded-lg p-1" id="plan-bmi">IMC: 00.0</div>
                        </div>

                        <div class="bg-white rounded-2xl p-5 border border-purple-100 shadow-sm">
                            <h4 class="font-bold text-purple-600 mb-2 flex items-center gap-2">
                                <i class="fa-solid fa-lightbulb"></i> Dica da Bestie
                            </h4>
                            <p class="text-sm text-gray-600" id="plan-tip">...</p>
                        </div>

                        <div class="bg-yellow-50 rounded-2xl p-5 border border-yellow-100 shadow-sm text-center">
                            <p class="text-sm text-gray-600 italic font-medium" id="plan-quote">"..."</p>
                        </div>
                    </div>
                </div>
            `,
            workout: `
                <div class="fade-in pb-20">
                    <div class="mb-6 flex items-center gap-3">
                        <button onclick="navigate('home')" class="w-8 h-8 rounded-full bg-pink-50 text-bestie flex items-center justify-center hover:bg-pink-100 transition">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">Treino da Bestie üèãÔ∏è‚Äç‚ôÄÔ∏è</h2>
                    </div>

                    <div class="bg-gradient-to-br from-red-50 to-pink-50 border border-red-100 rounded-3xl p-6 shadow-sm mb-6">
                        <p class="text-gray-600 text-sm mb-4">Escolha como voc√™ quer treinar hoje e eu monto tudo!</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Tempo Dispon√≠vel</label>
                                <select id="workout-time" class="w-full bg-white border border-pink-200 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition text-gray-600">
                                    <option value="15">15 minutos (R√°pido)</option>
                                    <option value="30">30 minutos (M√©dio)</option>
                                    <option value="45">45 minutos (Completo)</option>
                                    <option value="60">60 minutos (Intenso)</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Foco do Treino</label>
                                <select id="workout-focus" class="w-full bg-white border border-pink-200 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition text-gray-600">
                                    <option value="Full Body">Corpo Todo (Full Body)</option>
                                    <option value="Legs & Glutes">Pernas e Gl√∫teos</option>
                                    <option value="Upper Body">Superiores (Bra√ßos/Costas)</option>
                                    <option value="Abs & Cardio">Abd√¥men e Cardio</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Equipamento</label>
                                <select id="workout-equip" class="w-full bg-white border border-pink-200 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition text-gray-600">
                                    <option value="Bodyweight">S√≥ o peso do corpo</option>
                                    <option value="Dumbbells">Pesos Livres / Halteres</option>
                                    <option value="Resistance Bands">El√°sticos</option>
                                    <option value="Gym Machine">M√°quinas de Academia</option>
                                </select>
                            </div>
                        </div>

                        <button onclick="generateWorkout()" id="workout-btn" class="w-full mt-6 bg-gradient-to-r from-red-400 to-pink-500 text-white py-3 rounded-xl font-bold shadow-lg shadow-red-200 hover:scale-[1.02] transition active:scale-95 flex items-center justify-center gap-2">
                            <span>Gerar Treino Agora</span>
                            <i class="fa-solid fa-fire"></i>
                        </button>
                    </div>

                    <div id="workout-result" class="hidden space-y-4">
                        <div id="workout-card"></div>
                    </div>
                </div>
            `,
            sos: `
                <div class="fade-in pb-20">
                    <div class="mb-6 flex items-center gap-3">
                        <button onclick="navigate('home')" class="w-8 h-8 rounded-full bg-pink-50 text-bestie flex items-center justify-center hover:bg-pink-100 transition">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800">SOS Bestie üÜò</h2>
                    </div>

                    <div class="bg-gradient-to-br from-indigo-50 to-pink-50 border border-indigo-100 rounded-3xl p-6 shadow-sm mb-6">
                        <p class="text-gray-600 text-sm mb-4">Miga, qual √© a emerg√™ncia? Me conta que eu te ajudo sem julgamentos! üíï</p>
                        
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <button onclick="triggerSOS('Comi demais e estou me sentindo culpada')" class="bg-white border border-indigo-100 rounded-xl p-3 text-xs text-indigo-500 font-medium hover:bg-indigo-50 transition text-center">üçï Jaquei feio!</button>
                            <button onclick="triggerSOS('Estou com muita pregui√ßa de treinar hoje')" class="bg-white border border-indigo-100 rounded-xl p-3 text-xs text-indigo-500 font-medium hover:bg-indigo-50 transition text-center">üò¥ Pregui√ßa de treinar</button>
                            <button onclick="triggerSOS('Estou muito ansiosa e quero comer doce')" class="bg-white border border-indigo-100 rounded-xl p-3 text-xs text-indigo-500 font-medium hover:bg-indigo-50 transition text-center">üç´ Ansiedade a mil</button>
                            <button onclick="triggerSOS('Vou sair para comer/beber e n√£o sei o que fazer')" class="bg-white border border-indigo-100 rounded-xl p-3 text-xs text-indigo-500 font-medium hover:bg-indigo-50 transition text-center">ü•Ç Vou sair hoje</button>
                        </div>
                        
                        <div class="relative">
                            <input type="text" id="sos-input" placeholder="Outra emerg√™ncia..." class="w-full bg-white border border-indigo-200 rounded-xl p-3 text-sm focus:outline-none focus:border-indigo-400 transition placeholder-gray-400">
                            <button onclick="triggerSOS(document.getElementById('sos-input').value)" class="absolute right-2 top-2 w-8 h-8 bg-indigo-400 text-white rounded-lg flex items-center justify-center hover:bg-indigo-500 transition"><i class="fa-solid fa-paper-plane text-xs"></i></button>
                        </div>
                    </div>

                    <div id="sos-result" class="hidden space-y-4">
                        <div class="bg-white rounded-2xl p-5 border border-indigo-100 shadow-sm relative">
                            <div class="absolute -top-3 left-4 bg-indigo-500 text-white text-[10px] font-bold px-2 py-1 rounded">Conselho da Bestie</div>
                            <p class="text-sm text-gray-600 leading-relaxed mt-2" id="sos-text">...</p>
                        </div>
                    </div>
                </div>
            `,
            profile: `
                <div class="fade-in pb-20 pt-6">
                    <div class="mb-6 text-center">
                        <div class="w-20 h-20 bg-pink-100 rounded-full mx-auto mb-4 border-4 border-white shadow-md overflow-hidden">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Bestie" id="profile-avatar" alt="Profile" />
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">Seu Perfil üíñ</h2>
                    </div>
                    
                    <div class="bg-white rounded-3xl p-6 shadow-sm border border-pink-100 space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Nome / Apelido</label>
                            <input type="text" id="profile-name" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Idade</label>
                                <input type="number" id="profile-age" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Peso Atual (kg)</label>
                                <input type="number" id="profile-weight" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Altura (cm)</label>
                                <input type="number" id="profile-height" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Meta de Peso (kg)</label>
                                <input type="number" id="profile-target-weight" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">Objetivo Principal</label>
                            <select id="profile-goal" class="w-full bg-gray-50 border border-pink-100 rounded-xl p-3 text-sm focus:outline-none focus:border-bestie transition text-gray-600">
                                <option value="perder">Secar (Perder Peso)</option>
                                <option value="manter">Manter Peso</option>
                                <option value="ganhar">Ganhar Massa (Hipertrofia)</option>
                            </select>
                        </div>

                        <button onclick="saveProfile()" class="w-full mt-4 bg-bestie text-white py-3 rounded-xl font-bold shadow-lg shadow-pink-200 hover:scale-[1.02] transition active:scale-95">
                            Salvar Dados
                        </button>
                    </div>
                </div>
            `
        };

        function init() {
            navigate('home'); 
            renderRecipes('all');
        }

        function saveProfile() {
            const name = document.getElementById('profile-name').value;
            const age = document.getElementById('profile-age').value;
            const weight = document.getElementById('profile-weight').value;
            const targetWeight = document.getElementById('profile-target-weight').value;
            const height = document.getElementById('profile-height').value;
            const goal = document.getElementById('profile-goal').value;

            userProfile = { name, age, weight, targetWeight, height, goal };
            localStorage.setItem('bestieProfile', JSON.stringify(userProfile));
            
            // Update Avatar
            document.getElementById('profile-avatar').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${name}`;
            
            alert('Perfil salvo com sucesso! üíñ');
        }

        function navigate(viewName) {
            // Update Content
            const main = document.getElementById('app-content');
            if (views[viewName]) {
                main.innerHTML = views[viewName];
            } else {
                console.error(`View "${viewName}" not found!`);
                return;
            }

            // View Specific Logic
            if(viewName === 'profile') {
                setTimeout(() => {
                    document.getElementById('profile-name').value = userProfile.name || '';
                    document.getElementById('profile-age').value = userProfile.age || '';
                    document.getElementById('profile-weight').value = userProfile.weight || '';
                    document.getElementById('profile-target-weight').value = userProfile.targetWeight || '';
                    document.getElementById('profile-height').value = userProfile.height || '';
                    document.getElementById('profile-goal').value = userProfile.goal || 'perder';
                    document.getElementById('profile-avatar').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${userProfile.name || 'Bestie'}`;
                }, 0);
            }
            
            if(viewName === 'calculator') {
                 setTimeout(() => {
                    // Pre-fill calculator if profile data exists
                    if(userProfile.age) document.getElementById('calc-age').value = userProfile.age;
                    if(userProfile.weight) document.getElementById('calc-weight').value = userProfile.weight;
                    if(userProfile.targetWeight) document.getElementById('calc-target-weight').value = userProfile.targetWeight;
                    if(userProfile.height) document.getElementById('calc-height').value = userProfile.height;
                    if(userProfile.goal) document.getElementById('calc-goal').value = userProfile.goal;
                }, 0);
            }

             if(viewName === 'water') {
                // Calc dynamic water goal: 35ml per kg. Default to 2.5L if no weight.
                if (userProfile.weight) {
                    waterGoalLiters = (userProfile.weight * 0.035).toFixed(1);
                    // Approx cups (250ml)
                    waterGoalCups = Math.ceil((waterGoalLiters * 1000) / 250);
                } else {
                    waterGoalLiters = 2.5;
                    waterGoalCups = 10;
                }
                
                // Update DOM elements for water view
                setTimeout(() => {
                    document.getElementById('water-goal-liters').innerText = waterGoalLiters + 'L';
                    document.getElementById('water-goal-total-cups').innerText = '/' + waterGoalCups;
                    updateWater(0); // Initialize visual state
                }, 0);
            }


            // Update Nav State
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-bestie');
                btn.classList.add('text-gray-400');
                if(viewName === 'home' && btn.innerText.includes('In√≠cio')) btn.classList.add('text-bestie'), btn.classList.remove('text-gray-400');
                if((viewName === 'recipes' || viewName === 'chefBestie') && btn.innerText.includes('Receitas')) {
                    btn.classList.add('text-bestie');
                    btn.classList.remove('text-gray-400');
                }
                if(viewName === 'calculator' && btn.innerText.includes('Calc')) btn.classList.add('text-bestie'), btn.classList.remove('text-gray-400');
                if(viewName === 'profile' && btn.innerText.includes('Perfil')) btn.classList.add('text-bestie'), btn.classList.remove('text-gray-400');
            });

            if(viewName === 'recipes') {
                renderRecipes('all');
            }
        }

        function updateWater(change) {
            waterIntake += change;
            if(waterIntake < 0) waterIntake = 0;
            // Cap at goal + extra buffer just for visual fun, but logic is goal
            if(waterIntake > waterGoalCups + 5) waterIntake = waterGoalCups + 5; 

            const countEl = document.getElementById('water-count');
            const fillEl = document.getElementById('water-level');
            
            if(countEl && fillEl) {
                countEl.innerText = waterIntake;
                // Percentage based on dynamic goal
                let percentage = (waterIntake / waterGoalCups) * 100;
                if(percentage > 100) percentage = 100;
                fillEl.style.height = `${percentage}%`;
            }
        }

        function filterRecipes(tag, btnElement) {
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.classList.remove('bg-bestie', 'text-white', 'shadow-md');
                btn.classList.add('bg-white', 'text-gray-500', 'border', 'hover:text-bestie');
            });
            btnElement.classList.remove('bg-white', 'text-gray-500', 'border', 'hover:text-bestie');
            btnElement.classList.add('bg-bestie', 'text-white', 'shadow-md');

            renderRecipes(tag);
        }

        function renderRecipes(filterTag) {
            const grid = document.getElementById('recipe-grid');
            if(!grid) return;

            grid.innerHTML = '';
            
            // Check if recipe tags array includes the selected filter tag
            const filtered = filterTag === 'all' 
                ? recipes 
                : recipes.filter(r => r.tags && r.tags.includes(filterTag));

            if(filtered.length === 0) {
                grid.innerHTML = `
                    <div class="text-center py-10 flex flex-col items-center">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-3 text-gray-300">
                            <i class="fa-solid fa-cookie-bite text-2xl"></i>
                        </div>
                        <p class="text-gray-400 font-medium">Nenhuma receitinha nessa categoria :(</p>
                        <p class="text-gray-300 text-xs mt-1">Tente outro filtro!</p>
                    </div>`;
                return;
            }

            filtered.forEach(recipe => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-2xl p-3 shadow-sm border border-pink-50 flex gap-4 hover:border-pink-200 transition cursor-pointer";
                card.onclick = () => openRecipe(recipe.id);
                
                card.innerHTML = `
                    <div class="flex-1 flex flex-col justify-center">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800 leading-tight line-clamp-2">${recipe.title}</h3>
                            <i class="fa-regular fa-bookmark text-gray-300"></i>
                        </div>
                        <div class="flex flex-wrap gap-1 mt-1.5">
                            <span class="text-[10px] text-bestie font-bold bg-pink-50 px-2 py-0.5 rounded">${recipe.calories} kcal</span>
                            <span class="text-[10px] text-gray-500 bg-gray-100 px-2 py-0.5 rounded">${recipe.displayCategory}</span>
                        </div>
                        <div class="mt-auto flex items-center gap-3 text-xs text-gray-400">
                            <span class="flex items-center gap-1"><i class="fa-regular fa-clock"></i> ${recipe.time}</span>
                            <span class="flex items-center gap-1"><i class="fa-solid fa-list-ul"></i> ${recipe.ingredients.length} ingr.</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-center pr-1">
                        <button class="w-8 h-8 rounded-full bg-pink-50 text-bestie hover:bg-bestie hover:text-white transition flex items-center justify-center">
                            <i class="fa-solid fa-chevron-right text-xs"></i>
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function openRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if(!recipe) return;

            document.getElementById('modal-tag').innerText = recipe.displayCategory;
            document.getElementById('modal-title').innerText = recipe.title;
            document.getElementById('modal-cal').innerText = recipe.calories;
            document.getElementById('modal-time').innerText = recipe.time;
            document.getElementById('modal-difficulty').innerText = recipe.difficulty || "F√°cil";
            document.getElementById('modal-yield').innerText = recipe.yield || "1 por√ß√£o";
            document.getElementById('modal-desc').innerText = recipe.description || "";

            // Handle "Dica de Ouro" extraction
            const desc = recipe.description || "";
            const tipContainer = document.getElementById('modal-tip-container');
            const tipText = document.getElementById('modal-tip-text');
            
            if (desc.includes("Dica:")) {
                const parts = desc.split("Dica:");
                document.getElementById('modal-desc').innerText = parts[0].trim();
                tipText.innerText = parts[1].trim();
                tipContainer.classList.remove('hidden');
            } else {
                document.getElementById('modal-desc').innerText = desc;
                tipContainer.classList.add('hidden');
            }

            const ingList = document.getElementById('modal-ingredients');
            ingList.innerHTML = recipe.ingredients.map(ing => `<li class="flex items-start gap-2"><span class="w-1.5 h-1.5 rounded-full bg-bestie mt-1.5 flex-shrink-0"></span>${ing}</li>`).join('');

            const instList = document.getElementById('modal-instructions');
            instList.innerHTML = recipe.instructions.map((step, idx) => `
                <div class="flex gap-3">
                    <div class="w-6 h-6 rounded-full bg-pink-100 text-bestie text-xs font-bold flex items-center justify-center flex-shrink-0">${idx + 1}</div>
                    <p class="leading-snug">${step}</p>
                </div>
            `).join('');

            const modal = document.getElementById('recipe-modal');
            const panel = document.getElementById('modal-panel');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                panel.classList.remove('translate-y-full');
            }, 10);
        }

        function closeRecipeModal() {
            const modal = document.getElementById('recipe-modal');
            const panel = document.getElementById('modal-panel');
            
            panel.classList.add('translate-y-full');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        async function generatePlan() {
            const age = document.getElementById('calc-age').value;
            const weight = document.getElementById('calc-weight').value;
            const targetWeight = document.getElementById('calc-target-weight').value;
            const height = document.getElementById('calc-height').value;
            const goal = document.getElementById('calc-goal').value;
            
            const resultContainer = document.getElementById('plan-result');
            const btn = document.getElementById('plan-btn');

            if(!age || !weight || !height) {
                alert("Preencha todos os campos, bestie!");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div> Calculando...`;
            resultContainer.classList.add('hidden');

            const planData = await callGeminiPlan({age, weight, targetWeight, height, goal});

            if(planData) {
                document.getElementById('plan-calories').innerText = planData.calories_target;
                document.getElementById('plan-protein').innerText = planData.macros.protein;
                document.getElementById('plan-carbs').innerText = planData.macros.carbs;
                document.getElementById('plan-fats').innerText = planData.macros.fats;
                document.getElementById('plan-tip').innerText = planData.tip;
                document.getElementById('plan-quote').innerText = `"${planData.motivational_quote}"`;
                document.getElementById('plan-bmi').innerText = `IMC: ${planData.bmi}`;

                resultContainer.classList.remove('hidden');
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert("Erro ao gerar plano. Tente novamente!");
            }

            btn.disabled = false;
            btn.innerHTML = `Gerar Plano Personalizado ‚ú®`;
        }

        async function generateWorkout() {
            const time = document.getElementById('workout-time').value;
            const focus = document.getElementById('workout-focus').value;
            const equip = document.getElementById('workout-equip').value;
            
            const resultContainer = document.getElementById('workout-result');
            const cardDiv = document.getElementById('workout-card');
            const btn = document.getElementById('workout-btn');

            btn.disabled = true;
            btn.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div> Montando Treino...`;
            resultContainer.classList.add('hidden');

            const workoutData = await callGeminiWorkout({time, focus, equipment: equip});

            if(workoutData) {
                cardDiv.innerHTML = `
                    <div class="bg-white rounded-3xl p-5 shadow-lg border border-red-100 overflow-hidden relative">
                        <div class="absolute top-0 right-0 bg-red-400 text-white text-xs font-bold px-3 py-1 rounded-bl-xl">
                            Treino IA üî•
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${workoutData.title}</h3>
                        
                        <div class="bg-red-50 p-3 rounded-xl mb-4 border border-red-100">
                            <span class="text-xs font-bold text-red-500 uppercase tracking-wider block mb-1">Aquecimento</span>
                            <p class="text-sm text-gray-700">${workoutData.warmup}</p>
                        </div>

                        <div class="mb-4">
                            <h4 class="font-bold text-gray-800 mb-3 text-sm flex items-center gap-2"><i class="fa-solid fa-dumbbell text-red-400"></i> Exerc√≠cios</h4>
                            <ul class="space-y-3">
                                ${workoutData.exercises.map(ex => `
                                    <li class="bg-gray-50 p-3 rounded-xl border border-gray-100">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="font-bold text-gray-700 text-sm">${ex.name}</span>
                                            <span class="text-xs font-bold bg-white px-2 py-1 rounded text-red-500 border border-red-100">${ex.reps}</span>
                                        </div>
                                        <p class="text-xs text-gray-500 italic">${ex.tips}</p>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>

                        <div class="bg-yellow-50 rounded-xl p-4 text-center border border-yellow-100">
                            <p class="text-sm text-gray-600 italic font-medium">"${workoutData.motivation}"</p>
                        </div>
                    </div>
                `;
                resultContainer.classList.remove('hidden');
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert("Erro ao gerar treino. Tente novamente!");
            }

            btn.disabled = false;
            btn.innerHTML = `<span>Gerar Treino Agora</span> <i class="fa-solid fa-fire"></i>`;
        }

        async function triggerSOS(situation) {
             const resultDiv = document.getElementById('sos-result');
             const sosText = document.getElementById('sos-text');
             
             if(!situation || situation.trim() === '') return;

             sosText.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div> Buscando ajuda...`;
             resultDiv.classList.remove('hidden');

             const advice = await callGeminiSOS(situation);
             
             if(advice) {
                 sosText.innerText = advice;
             } else {
                 sosText.innerText = "Ops! N√£o consegui conectar com a central de ajuda agora. Mas respira fundo que vai ficar tudo bem! üíñ";
             }
        }

        async function generateAIRecipe() {
            const input = document.getElementById('ai-ingredients');
            const btn = document.getElementById('generate-btn');
            const resultDiv = document.getElementById('ai-result');
            const cardDiv = document.getElementById('ai-recipe-card');

            if (!input.value.trim()) return;

            // Loading State
            btn.disabled = true;
            btn.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div> Criando...`;
            resultDiv.classList.add('hidden');

            const recipeData = await callGemini(input.value);

            if (recipeData) {
                // Assign a temporary random ID
                recipeData.id = 999; 

                // Render Card (similar to renderRecipes but customized)
                cardDiv.innerHTML = `
                    <div class="bg-white rounded-3xl p-5 shadow-lg border border-pink-100 overflow-hidden relative">
                        <div class="absolute top-0 right-0 bg-bestie text-white text-xs font-bold px-3 py-1 rounded-bl-xl">
                            IA ‚ú®
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${recipeData.title}</h3>
                        <p class="text-sm text-gray-500 italic mb-4">"${recipeData.description}"</p>
                        
                        <div class="flex gap-4 text-xs text-gray-500 mb-4 bg-pink-50 p-3 rounded-xl">
                            <span class="flex items-center gap-1"><i class="fa-solid fa-fire text-bestie"></i> ${recipeData.calories} kcal</span>
                            <span class="flex items-center gap-1"><i class="fa-regular fa-clock text-bestie"></i> ${recipeData.time}</span>
                            <span class="flex items-center gap-1"><i class="fa-solid fa-utensils text-bestie"></i> ${recipeData.difficulty}</span>
                        </div>

                        <div class="mb-4">
                            <h4 class="font-bold text-gray-800 mb-2 text-sm flex items-center gap-2"><i class="fa-solid fa-basket-shopping text-bestie"></i> Ingredientes</h4>
                            <ul class="text-sm text-gray-600 space-y-1 list-disc pl-4">
                                ${recipeData.ingredients.map(i => `<li>${i}</li>`).join('')}
                            </ul>
                        </div>

                        <div>
                            <h4 class="font-bold text-gray-800 mb-2 text-sm flex items-center gap-2"><i class="fa-solid fa-spoon text-bestie"></i> Modo de Preparo</h4>
                            <ol class="text-sm text-gray-600 space-y-2 list-decimal pl-4">
                                ${recipeData.instructions.map(i => `<li>${i}</li>`).join('')}
                            </ol>
                        </div>
                    </div>
                `;
                resultDiv.classList.remove('hidden');
                resultDiv.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert("Ops! Ocorreu um erro ao criar a receita. Tente novamente!");
            }

            // Reset Button
            btn.disabled = false;
            btn.innerHTML = `<span>Criar Outra Receita</span> <i class="fa-solid fa-wand-magic-sparkles"></i>`;
        }

        async function generateSwap() {
            const input = document.getElementById('swap-input');
            const btn = document.getElementById('swap-btn');
            const resultDiv = document.getElementById('swap-result');
            const swapText = document.getElementById('swap-text');

            if (!input.value.trim()) return;

            // Loading state
            const originalBtnContent = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i>`;
            
            resultDiv.classList.add('hidden');

            const suggestion = await callGeminiSwap(input.value);

            if (suggestion) {
                swapText.innerText = suggestion;
                resultDiv.classList.remove('hidden');
            } else {
                alert("Ops! Bestie ocupada. Tente novamente!");
            }

            btn.disabled = false;
            btn.innerHTML = originalBtnContent;
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
